"""天干地支基础数据定义"""

# ============ 天干 ============
TIANGAN = ["甲", "乙", "丙", "丁", "戊", "己", "庚", "辛", "壬", "癸"]

TIANGAN_WUXING = {
    "甲": "木", "乙": "木",
    "丙": "火", "丁": "火",
    "戊": "土", "己": "土",
    "庚": "金", "辛": "金",
    "壬": "水", "癸": "水",
}

TIANGAN_YINYANG = {
    "甲": "阳", "乙": "阴",
    "丙": "阳", "丁": "阴",
    "戊": "阳", "己": "阴",
    "庚": "阳", "辛": "阴",
    "壬": "阳", "癸": "阴",
}

# ============ 地支 ============
DIZHI = ["子", "丑", "寅", "卯", "辰", "巳", "午", "未", "申", "酉", "戌", "亥"]

DIZHI_WUXING = {
    "子": "水", "丑": "土",
    "寅": "木", "卯": "木",
    "辰": "土", "巳": "火",
    "午": "火", "未": "土",
    "申": "金", "酉": "金",
    "戌": "土", "亥": "水",
}

DIZHI_YINYANG = {
    "子": "阳", "丑": "阴",
    "寅": "阳", "卯": "阴",
    "辰": "阳", "巳": "阴",
    "午": "阳", "未": "阴",
    "申": "阳", "酉": "阴",
    "戌": "阳", "亥": "阴",
}

# 地支藏干（本气、中气、余气）
DIZHI_CANGGAN = {
    "子": ["癸"],
    "丑": ["己", "癸", "辛"],
    "寅": ["甲", "丙", "戊"],
    "卯": ["乙"],
    "辰": ["戊", "乙", "癸"],
    "巳": ["丙", "庚", "戊"],
    "午": ["丁", "己"],
    "未": ["己", "丁", "乙"],
    "申": ["庚", "壬", "戊"],
    "酉": ["辛"],
    "戌": ["戊", "辛", "丁"],
    "亥": ["壬", "甲"],
}

# ============ 六十甲子 ============
JIAZI_60 = []
for i in range(60):
    JIAZI_60.append(TIANGAN[i % 10] + DIZHI[i % 12])

# ============ 纳音五行 ============
NAYIN = {
    "甲子": "海中金", "乙丑": "海中金",
    "丙寅": "炉中火", "丁卯": "炉中火",
    "戊辰": "大林木", "己巳": "大林木",
    "庚午": "路旁土", "辛未": "路旁土",
    "壬申": "剑锋金", "癸酉": "剑锋金",
    "甲戌": "山头火", "乙亥": "山头火",
    "丙子": "涧下水", "丁丑": "涧下水",
    "戊寅": "城头土", "己卯": "城头土",
    "庚辰": "白蜡金", "辛巳": "白蜡金",
    "壬午": "杨柳木", "癸未": "杨柳木",
    "甲申": "泉中水", "乙酉": "泉中水",
    "丙戌": "屋上土", "丁亥": "屋上土",
    "戊子": "霹雳火", "己丑": "霹雳火",
    "庚寅": "松柏木", "辛卯": "松柏木",
    "壬辰": "长流水", "癸巳": "长流水",
    "甲午": "沙中金", "乙未": "沙中金",
    "丙申": "山下火", "丁酉": "山下火",
    "戊戌": "平地木", "己亥": "平地木",
    "庚子": "壁上土", "辛丑": "壁上土",
    "壬寅": "金箔金", "癸卯": "金箔金",
    "甲辰": "覆灯火", "乙巳": "覆灯火",
    "丙午": "天河水", "丁未": "天河水",
    "戊申": "大驿土", "己酉": "大驿土",
    "庚戌": "钗钏金", "辛亥": "钗钏金",
    "壬子": "桑柘木", "癸丑": "桑柘木",
    "甲寅": "大溪水", "乙卯": "大溪水",
    "丙辰": "沙中土", "丁巳": "沙中土",
    "戊午": "天上火", "己未": "天上火",
    "庚申": "石榴木", "辛酉": "石榴木",
    "壬戌": "大海水", "癸亥": "大海水",
}

# ============ 五行生克 ============
WUXING_SHENG = {"木": "火", "火": "土", "土": "金", "金": "水", "水": "木"}  # X 生 Y
WUXING_KE = {"木": "土", "火": "金", "土": "水", "金": "木", "水": "火"}    # X 克 Y

# ============ 时辰 ============
SHICHEN_NAMES = ["子时", "丑时", "寅时", "卯时", "辰时", "巳时",
                 "午时", "未时", "申时", "酉时", "戌时", "亥时"]

SHICHEN_HOURS = [
    (23, 1),   # 子时 23:00-01:00
    (1, 3),    # 丑时 01:00-03:00
    (3, 5),    # 寅时 03:00-05:00
    (5, 7),    # 卯时 05:00-07:00
    (7, 9),    # 辰时 07:00-09:00
    (9, 11),   # 巳时 09:00-11:00
    (11, 13),  # 午时 11:00-13:00
    (13, 15),  # 未时 13:00-15:00
    (15, 17),  # 申时 15:00-17:00
    (17, 19),  # 酉时 17:00-19:00
    (19, 21),  # 戌时 19:00-21:00
    (21, 23),  # 亥时 21:00-23:00
]

# 旬首对应六仪（用于奇门遁甲）
XUN_LIUYI = {
    "甲子": "戊", "甲戌": "己", "甲申": "庚",
    "甲午": "辛", "甲辰": "壬", "甲寅": "癸",
}

# 六甲旬首列表
XUN_HEADS = ["甲子", "甲戌", "甲申", "甲午", "甲辰", "甲寅"]


def hour_to_shichen_index(hour: int) -> int:
    """将小时(0-23)转换为时辰索引(0-11)"""
    if hour == 23 or hour == 0:
        return 0  # 子时
    return (hour + 1) // 2


def get_ganzhi_str(tg_index: int, dz_index: int) -> str:
    """将天干地支索引转为字符串"""
    return TIANGAN[tg_index % 10] + DIZHI[dz_index % 12]


def get_nayin(ganzhi: str) -> str:
    """获取纳音"""
    return NAYIN.get(ganzhi, "")


def get_canggan(dz: str) -> list:
    """获取地支藏干"""
    return DIZHI_CANGGAN.get(dz, [])


def find_xun_head(ganzhi: str) -> str:
    """找到干支所在的旬首（甲子/甲戌/甲申/甲午/甲辰/甲寅）"""
    if ganzhi in JIAZI_60:
        idx = JIAZI_60.index(ganzhi)
    else:
        return ""
    xun_start = (idx // 10) * 10
    return JIAZI_60[xun_start]


def find_xun_head_liuyi(ganzhi: str) -> str:
    """找到干支对应旬首的六仪"""
    head = find_xun_head(ganzhi)
    return XUN_LIUYI.get(head, "")


def wuxing_relation(me: str, other: str) -> str:
    """判断两个五行的生克关系（以me为主）
    返回: '同我'/'我生'/'我克'/'克我'/'生我'
    """
    wx_me = TIANGAN_WUXING.get(me) or DIZHI_WUXING.get(me, "")
    wx_other = TIANGAN_WUXING.get(other) or DIZHI_WUXING.get(other, "")
    if wx_me == wx_other:
        return "同我"
    if WUXING_SHENG[wx_me] == wx_other:
        return "我生"
    if WUXING_KE[wx_me] == wx_other:
        return "我克"
    if WUXING_SHENG[wx_other] == wx_me:
        return "生我"
    if WUXING_KE[wx_other] == wx_me:
        return "克我"
    return ""
